<!doctype html><html><head><meta charset="UTF-8"><title>Darkside</title><style type="text/css">*{margin:0;padding:0}body,canvas,html{width:100%;height:100%}canvas{display:block}</style></head><body><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t){t.exports={VACUUM:[0,0,0,0,0,0],SCHOTT_BK7:[1.03961212,.231792344,.231792344,.00600069867,.0200179144,103.560653],SCHOTT_BAF10:[1.5851495,.143559385,1.08521269,.00926681282,.0424489805,105.613573]}},function(t,e,i){},function(t,e,i){"use strict";i.r(e);class s{constructor(t=0,e=0){this.x=t,this.y=e}toRadians(){return Math.atan2(this.y,this.x)}static fromRadians(t){return new s(Math.cos(t),Math.sin(t))}static average(t,e){return new s((t.x+e.x)/2,(t.y+e.y)/2)}scale(t){return new s(this.x*t,this.y*t)}plus(t){return new s(this.x+t.x,this.y+t.y)}minus(t){return new s(this.x-t.x,this.y-t.y)}magnitude(){return Math.hypot(this.x,this.y)}normalize(){return this.scale(1/this.magnitude())}rotate(t){return new s(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}}function n(t,e,i){e.beginPath(),e.fillStyle=i.toString();let s=t[t.length-1];e.moveTo(s.x,s.y);for(let i of t)e.lineTo(i.x,i.y);e.fill()}class r{constructor(t=0,e=0,i=0){this.r=Math.min(Math.max(t,0),255),this.g=Math.min(Math.max(e,0),255),this.b=Math.min(Math.max(i,0),255)}toString(){return"#"+this.r.toString(16).padStart(2,"0")+this.g.toString(16).padStart(2,"0")+this.b.toString(16).padStart(2,"0")}}class o{constructor(t=new s(0,0),e=0,i=[],n=0){this.offset=0,this.count=0,this.position=t,this.spectrum=i,this.rotation=e,this.bounces=n,this.endPoint=s.fromRadians(this.rotation).scale(1e4).plus(t)}collides(t){const e=this.position,i=s.fromRadians(this.rotation).scale(1e4).plus(e);let n=t.vertices[t.vertices.length-1],r=[];for(let s of t.vertices){const t=(i.x-e.x)*(s.y-n.y)-(s.x-n.x)*(i.y-e.y);if(0===t){n=s;continue}const o=((s.y-n.y)*(s.x-e.x)+(n.x-s.x)*(s.y-e.y))/t,a=((e.x-i.y)*(s.x-e.x)+(i.x-e.x)*(s.y-e.y))/t;0<o&&o<1&&0<a&&a<1&&r.push(e.plus(i.minus(e).scale(o))),n=s}if(0==r.length)return;let o=new s,a=Number.MAX_VALUE;for(let t of r){const e=t.minus(this.position).magnitude();a>e&&(a=e,o=t)}return o}draw(t,e,i){if(this.spectrum.length<1)return;this.offset=this.offset+i/350,this.count++;const s=this.spectrum.map(t=>t.toRGB()).reduce((t,e)=>new r(Math.floor((t.r+e.r)/1),Math.floor((t.g+e.g)/1),Math.floor((t.b+e.b)/1)));!function(t,e,i){e.beginPath(),e.strokeStyle=i.toString(),e.lineWidth=2,e.filter="blur(2px)";let s=t[t.length-1];e.moveTo(s.x,s.y);for(let i of t)e.lineTo(i.x,i.y);e.stroke()}([this.position,this.endPoint],t,s)}}class a{constructor(t=new r(0,0,0),e=new r(255,255,255),i=10,s="#FFFFFF",n=20){this.backgroundColor=t,this.lineColor=e,this.lineWidth=i,this.lightsourceColor=s,this.lightsourceRadius=n}}var h,l=i(0);!function(t){t.VACUUM="VACUUM",t.SCHOTT_BK7="SCHOTT_BK7",t.SCHOTT_BAF10="SCHOTT_BAF10"}(h||(h={}));class c{constructor(t=h.SCHOTT_BK7){this.name=t;const e=l[t];this.b1=e[0],this.b2=e[1],this.b3=e[2],this.c1=e[3],this.c2=e[4],this.c3=e[5]}refractiveIndex(t){t/=1e3;const e=this.b1*t**2/(t**2-this.c1),i=this.b2*t**2/(t**2-this.c2),s=this.b3*t**2/(t**2-this.c3);return Math.sqrt(1+e+i+s)}}class u{constructor(t=[],e=[],i=new a){this.lights=t,this.prisms=e,this.config=i}render(t,e){t.fillStyle=this.config.backgroundColor.toString(),t.fillRect(0,0,t.canvas.width,t.canvas.height),this.prisms.concat(this.lights).map(i=>{t.save(),i.draw(t,this.config,e),t.restore()})}update(t=0){const e=new c(h.VACUUM);for(let t of this.lights)for(let i of this.prisms){const s=t.collides(i);if(null!=s){t.endPoint=s;for(let n of t.spectrum){const r=t.bounces%2==0?n.refract(e,i.material,Math.PI/6+n.value/600):n.refract(i.material,e,Math.PI/6+n.value/600);this.lights.push(new o(s,r,[n],t.bounces+1)),console.log("Adding new LightSource: "),console.log(this.lights[this.lights.length-1])}break}}}}const f=new c;class d{constructor(t,e=f){this.vertices=t,this.inner=d.calculateInnerVertices(t),this.material=e}static calculateInnerVertices(t){let e=[];const i=t.reduce((t,e)=>t.plus(e)).scale(1/t.length);for(let s of t){const t=s.minus(i);e.push(t.normalize().scale(t.magnitude()-5).plus(i))}return e}setVertices(t){this.vertices=t,this.inner=d.calculateInnerVertices(t)}draw(t,e,i){t.shadowBlur=4,t.shadowColor=e.lineColor.toString(),n(this.vertices,t,e.lineColor),t.shadowBlur=5,t.shadowColor=e.backgroundColor.toString(),n(this.inner,t,e.backgroundColor)}}class g{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}toRGB(){let t=3.2404542*this.x-1.5371385*this.y-.4985314*this.z,e=-.969266*this.x+1.8760108*this.y+.041556*this.z,i=.0556434*this.x-.2040259*this.y+1.0572252*this.z;return t=Math.floor(255*this.gammaCorrection(t)),e=Math.floor(255*this.gammaCorrection(e)),i=Math.floor(255*this.gammaCorrection(i)),new r(t,e,i)}gammaCorrection(t){return t=Math.max(t,0),Math.abs(t)<.0031308?12.92*t:1.055*t**(1/2.4)-.055}}class m{constructor(t){this.value=t}refract(t,e,i){if(t.name===e.name)return i;const s=t.refractiveIndex(this.value),n=e.refractiveIndex(this.value);return Math.sin(i)*(s/n)}toRGB(){return this.toXYZ().toRGB()}toXYZ(){return new g(this.x(),this.y(),this.z())}x(){let t=(this.value-442)*(this.value<442?.0624:.0374),e=(this.value-599.8)*(this.value<599.8?.0264:.0323),i=(this.value-501.1)*(this.value<501.1?.049:.0382);return.362*Math.exp(-.5*t*t)+1.056*Math.exp(-.5*e*e)-.065*Math.exp(-.5*i*i)}y(){let t=(this.value-568.8)*(this.value<568.8?.0213:.0247),e=(this.value-530.9)*(this.value<530.9?.0613:.0322);return.821*Math.exp(-.5*t*t)+.286*Math.exp(-.5*e*e)}z(){let t=(this.value-437)*(this.value<437?.0845:.0278),e=(this.value-459)*(this.value<459?.0385:.0725);return 1.217*Math.exp(-.5*t*t)+.681*Math.exp(-.5*e*e)}}i(1);function p(t,e){const i=e.canvas;i.width=window.innerWidth,i.height=window.innerHeight;const n=new o(new s(.5*i.width-5,.5*i.height-5),0,[new m(475),new m(550)]),r=new s(.7*i.width,.5*i.height),a=new d(function(t,e,i=0){let n=t.x,r=t.y;return[new s(n-e*Math.sin(i),r-e*Math.cos(i)),new s(n-e*Math.sin(i+2*Math.PI/3),r-e*Math.cos(i+2*Math.PI/3)),new s(n-e*Math.sin(i+4*Math.PI/3),r-e*Math.cos(i+4*Math.PI/3))]}(r,100));t.lights=[n],t.prisms=[a]}document.addEventListener("DOMContentLoaded",()=>{console.log("Darkside started");let t=document.createElement("canvas");document.body.appendChild(t);let e=t.getContext("2d"),i=new u;window.addEventListener("resize",()=>p(i,e));p(i,e),i.update(),i.render(e,1/30);var s=performance.now();setInterval(()=>{let t=performance.now()-s;i.render(e,t),s=performance.now()},1e3/30)})}]);
//# sourceMappingURL=bundle.js.map</script></body></html>